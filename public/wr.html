<html>
	<head>
    	<link href="css/style.css" rel="stylesheet" type="text/css">
		<title>Index</title>
	</head>
	
	<body>
	
 		<!-- Send Message frame. A textbox and a send button. 
		<div class="msgframe">
			<div class="msghead"><strong>Broadcast message</strong></div>
			<div class="msgcontent">
				<input data-bind="value: msgToSend" /><button data-bind="click: wsTest">Send</button>
				<button data-bind="click: wsTestData">Test data</button>
			</div>
		</div>
		
		-->
		<!-- Result list: A table -->
		 
<h1>Web retrieval</h1>

	<!-- result list -->

		<div class="msgframe">
			<div class="msghead"><strong>Query results</strong></div>
			<div>
			<table>
			    <thead>
			        <tr  data-bind="foreach: columnNames">
			            <th class="reshead"> <span data-bind="text: $data.colname">Loading ..</span>
			
			            </th>
			        </tr>
			    </thead>
			    <tbody data-bind="foreach: items">
			        <tr class="resrow" data-bind="foreach: $parent.columnNames, click: $root.selRow">
			            <td class="rescell">
							<div data-bind="visible: $data.type!='url'"><span data-bind="text: $parent[$data.colname]"></span></div>
							<div data-bind="visible: $data.type=='url'"><span data-bind="text: $parent[$data.colname]"></button></div>
						</td>
			        </tr>
			    </tbody>
			</table>
			</div>
		</div>

	<!-- selected item detail-->

		<div class="msgframe" data-bind="visible: $root.selectedRow()">
			<div class="msghead"><strong>Details</strong></div>
			<div class="msgcontent">
				<!-- span data-bind="text: $root.getCol('_id')"></span -->
				<div/>
				<!-- vertical display of row properties -->
				<table>
					 <tbody data-bind="foreach: $root.columnNames">
			        		<tr class="resrow">
			            			<td class="rescell">
								<div><span data-bind="text: $data.colname"></span></div>
							</td>
							<td class="rescell">
								<div><span data-bind="text: $root.getCol($data.colname)"></span></div>
							</td>
			        		</tr>
			    		</tbody>
				</table>
			
			</div>

		</div>

        <!-- selected document options --> 

		<div class="msgframe" data-bind="visible: $root.selectedRow()">
			<div class="msghead"><strong>Document</strong></div>
			<div><button data-bind="click: $root.openDoc">Open</button></div>
			<div>
				<img  data-bind="attr:{src: getThumbUrl}" />
			</div>
		</div> 
		
	</body>

</html>


<!--Include JavaScripts for JQuery and Knockout.js <-->
<script type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js'></script>
<script type='text/javascript', src='http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js'></script>

<script type="text/javascript">
	
        // Here's my data model
        var viewModel = function () {


		var self=this;

            	self.items=ko.observableArray();
		self.columnNames = ko.computed(function() {
			if (self.items().length === 0)
            			return [];
        		var props = [];
        		var obj = self.items()[0];
        		for (var name in obj) {
				if (name==='_id') {
					props.push({'colname':'_id', 'type':'url'});	
				} else {
					props.push({'colname':name, 'type':''});
				}
         		}
			
        		return props;
  		});

		// observes the selected row in result list
		self.selectedRow = ko.observable();

		// returns the value of a column identified by name from the selected row in result list
		self.getCol = function(col) {

			var jso = self.selectedRow();
			if (jso) {
				var run = jso[col];
				return run
			}
		};
  
/*
		self.selectedRowJ = ko.computed(function() {
			return  JSON.stringify(self.selectedRow());
		});
*/

		self.populate = function() {
			self.items.push({'Portfolio': '1001001','Pseudonym': 'LUNA', 'DocumentType':'Form A','Signed':'02.04.2014', 'Scanned':'03.04.2014', 'RunNr':'3454', '_id':1});
			 self.items.push({'Portfolio': '1001001','Pseudonym': 'LUNA', 'DocumentType':'Procuration','Signed':'03.04.2014', 'Scanned':'04.04.2014', 'RunNr':'5012', '_id':2});
			 self.items.push({'Portfolio': '1001001','Pseudonym': 'LUNA', 'DocumentType':'Non-US Disclosure','Signed':'03.04.2014', 'Scanned':'04.04.2014', 'RunNr':'3654', '_id':3});
			 self.items.push({'Portfolio': '1001001','Pseudonym': 'LUNA', 'DocumentType':'E-Banking contract','Signed':'04.04.2014', 'Scanned':'05.04.2014', 'RunNr':'5097', '_id':4});
						
			// self.items.push({'Artist': 'Brahms','Album': 'Klavierkonzert 1', 'DocumentType':'MP3'});
			// self.items.push({'Artist': 'Wagner','Album': 'Die Walk√ºrie', 'DocumentType':'CD'});
			// self.items.push({'Artist': 'Portishead','Album': 'Dummy', 'DocumentType':'WAV'});
	
		};

// Event handlers

		// called when user selects a row in result list
		self.selRow = function(row) {
			self.selectedRow(row);
			self.getThumbUrl();
			// alert(row._id.toString());
		};

		self.openDoc = function() {
			var id = self.getCol('_id');
			if (id) {
				window.location.href = "../pdf?density=96&page="+id.toString();	
			}
		}

		self.getThumbUrl = ko.computed(function() {
			var id = self.getCol('_id');
			if (id) {
				return "../pdf?density=48&page="+id.toString();	
			}
		});
     	};
	
	var vm = new viewModel();
			
        ko.applyBindings(vm); // This makes Knockout get to work
	
	vm.populate();
		
 </script>
 
